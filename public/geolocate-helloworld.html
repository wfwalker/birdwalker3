<html> 
	<head>
		<title>Where has Bill gone birding near me?</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js" type="text/javascript"></script>
	</head>
	
	
	<body>              
		<h1>Where has Bill gone birding near me?</h1>    
		
		<form id="milesForm"> 
			Miles: <input id="milesField" type="text" name="radius" />
			<input type="submit" />
		</form>

		<div id="results">
		</div>
		
		<script language="JavaScript">  
			miles_radius = 5;
			
			function find_nearby_locations(position) {  
			  	$("input#lat").val(position.coords.latitude)
			  	$("input#lat").val(position.coords.longitude)
			                                               			
				$.ajax({
					url: "http://localhost:3000/locations/locations_near?lat=" + position.coords.latitude + "&long=" + position.coords.longitude + "&miles=" + miles_radius,
					error: function() { alert("error "); },               

					success: function(results) {      
						$("div#results").empty()
						$("div#results").append("<table>"); 		            
						for each (var location in results) {
							$("div#results").append("<tr>"); 
							$("div#results").append("<td>" + location.name + "</td>"); 
							$("div#results").append("<td>" + location.city + "</td>"); 
							$("div#results").append("<td>" + location.id + "</td>"); 
							$("div#results").append("</tr>"); 
						}
						$("div#results").append("</table>"); 		            
					},
				 });
			}

			$(document).ready(function(){  
				$('#milesForm').submit(function() { 
					miles_radius = $("#milesField").val()					
					console.log("getting location with radius " + miles_radius)  
					$("div#results").empty()
					$("div#results").append("<div>working</div>")
					navigator.geolocation.getCurrentPosition(find_nearby_locations);
					return false;
				});
			});

		</script>
 	</body>
</html>